@page "{language?}"
@inject CommonLocalizationService localizer
@using LEotA.Services
@using System.Linq;
@using Microsoft.AspNetCore.Localization
@model MainPageModel
@{
    try
    {
        ViewData["Title"] = "Home page";
        var newsGetPagedCount = (int) ViewData["newsGetPagedCount"];
    
        var newsGetPaged = (List<News>) ViewData["newsGetPaged"];
   
        var newsImages = (Dictionary<News, List<FileContent>>) ViewData["newsListWithImage"];
    
        var culture = HttpContext.Features.Get<IRequestCultureFeature>().RequestCulture.Culture.Name;
        
    <div class="text-center mb-5">
        <h1 class="display-4 ">@localizer.Get("Welcome")</h1>
    </div>


    @if (!(newsGetPagedCount > 0))
    {
        <SfSpinner Visible="true" Lable="Loading data ...">
        </SfSpinner>
    }
    else
    {
        
        <div class="album py-5 bg-light">
            <div class="container">
                    @for (int i = 0; i < (newsGetPagedCount)/2 + newsGetPagedCount%2; i++)
                    {
                        if (Model.Pager.CurrentPage<1)
                        {
                            <div class="row">
                            @if (i == newsGetPagedCount/2 && newsGetPagedCount % 2 == 1)
                            {
                                for (int j = 0; j < newsGetPagedCount % 2; j++)
                                {
                                    var image = newsImages.Values.ElementAt(Model.Pager.CurrentPage * 4 + i*2+j);
                                    var newsText = newsImages.Keys.ElementAt(Model.Pager.CurrentPage * 4 + i*2+j);
                                    <div class="col-6">
                                        <div class="news-container">
                                            <img src="data:image;base64,@Convert.ToBase64String(image.FirstOrDefault().Content)">
                                            <p class="top-right">@newsText.Time.Day - @newsText.Time.Month - @newsText.Time.Year</p>
                                            <p class="bottom-right">@newsText.Author</p>
                                            @if (culture == "en")
                                            {
                                                <h2 class="bottom-left"><a asp-area="" asp-page="/News" asp-route-id="@newsText.Id">@newsText.Name.English</a></h2>
                                            }
                                            else
                                            {
                                                <h2 class="bottom-left"><a asp-area="" asp-page="/News" asp-route-id="@newsText.Id">@newsText.Name.Russian</a></h2>
                                            }
                                        </div>
                                        <hr aria-hidden="true">
                                    </div>
                                }
                            }

                            else
                            {
                                @for (int j = 0; j < 2; j++)
                                {
                                    var image = newsImages.Values.ElementAt(Model.Pager.CurrentPage * 4 + i * 2 + j);
                                    var newsText = newsImages.Keys.ElementAt(Model.Pager.CurrentPage * 4 + i * 2 + j);
                                    <div class="col-6">
                                    
                                        <div class="news-container">
                                            <img src="data:image;base64,@Convert.ToBase64String(image.FirstOrDefault().Content)">
                                            <p class="top-right">@newsText.Time.Day - @newsText.Time.Month - @newsText.Time.Year</p>
                                            <p class="bottom-right">@newsText.Author</p>
                                            @if (culture == "en")
                                            {
                                                <h2 class="bottom-left"><a asp-area="" asp-page="/News" asp-route-id="@newsText.Id">@newsText.Name.English</a></h2>
                                            }
                                            else
                                            {
                                                <h2 class="bottom-left"><a asp-area="" asp-page="/News" asp-route-id="@newsText.Id">@newsText.Name.Russian</a></h2>
                                            }
                                        </div>
                                    </div>
                                }
                            }
                        </div>
                        }
                        else
                        {
                            <div class="row">
                            @if (i == newsGetPagedCount/2 && newsGetPagedCount % 2 == 1)
                            {
                                for (int j = 0; j < newsGetPagedCount % 2; j++)
                                {
                                    var image = newsImages.Values.ElementAt((Model.Pager.CurrentPage-1) * 4 + i*2+j);
                                    var newsText = newsImages.Keys.ElementAt((Model.Pager.CurrentPage-1) * 4 + i*2+j);
                                    <div class="col-6">
                                        <div class="news-container">
                                            <img src="data:image;base64,@Convert.ToBase64String(image.FirstOrDefault().Content)">
                                            <p class="top-right">@newsText.Time.Day - @newsText.Time.Month - @newsText.Time.Year</p>
                                            <p class="bottom-right">@newsText.Author</p>
                                            @if (culture == "en")
                                            {
                                                <h2 class="bottom-left"><a asp-area="" asp-page="/News" asp-route-id="@newsText.Id">@newsText.Name.English</a></h2>
                                            }
                                            else
                                            {
                                                <h2 class="bottom-left"><a asp-area="" asp-page="/News" asp-route-id="@newsText.Id">@newsText.Name.Russian</a></h2>
                                            }
                                        </div>
                                    </div>
                                }
                            }

                            else
                            {
                                @for (int j = 0; j < 2; j++)
                                {
                                    var image = newsImages.Values.ElementAt((Model.Pager.CurrentPage-1) * 4 + i * 2 + j);
                                    var newsText = newsImages.Keys.ElementAt((Model.Pager.CurrentPage-1) * 4 + i * 2 + j);
                                    <div class="col-6">
                                    
                                        <div class="news-container">
                                            <img src="data:image;base64,@Convert.ToBase64String(image.FirstOrDefault().Content)">
                                            <p class="top-right">@newsText.Time.Day - @newsText.Time.Month - @newsText.Time.Year</p>
                                            <p class="bottom-right">@newsText.Author</p>
                                            @if (culture == "en")
                                            {
                                                <h2 class="bottom-left"><a asp-area="" asp-page="/News" asp-route-id="@newsText.Id">@newsText.Name.English</a></h2>
                                            }
                                            else
                                            {
                                                <h2 class="bottom-left"><a asp-area="" asp-page="/News" asp-route-id="@newsText.Id">@newsText.Name.Russian</a></h2>
                                            }
                                        </div>
                                        
                                    </div>
                                }
                            }
                        </div>
                        }
                        
                    }
                   
            </div>
        </div>
        <!-- pager -->
        {
            @if (Model.Pager.Pages.Any())
            {
                <nav class="table-responsive mb-5">
                    <ul class="pagination justify-content-center d-flex flex-wrap">
                        @if (Model.Pager.CurrentPage > 1)
                        {
                            <li class="page-item">
                                <a class="page-link" href="/">First</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="/mainpage?p=@(Model.Pager.CurrentPage - 1)">Previous</a>
                            </li>
                        }

                        @for (int p=1;p<Model.Pager.TotalPages+1;p++)
                        {
                            <li class="page-item @(p == Model.Pager.CurrentPage ? "active" : "")">
                                <a class="page-link" href="/mainpage?p=@p">@p</a>
                            </li>
                        }

                        @if (Model.Pager.CurrentPage < Model.Pager.TotalPages)
                        {
                            <li class="page-item">
                                <a class="page-link" href="/mainpage?p=@(Model.Pager.CurrentPage + 1)">Next</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="/mainpage?p=@(Model.Pager.TotalPages)">Last</a>
                            </li>
                        }
                    </ul>
                </nav>
            }
        }
    }
    
    }

    catch (Exception e)
    { 
        @*     <p>NULL</p> *@
        <a><img style="margin-bottom:50px;" class="construction-img " src="/images/under-construction_geek_man_01.svg"></a>
    }
}
